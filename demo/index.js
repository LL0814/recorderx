!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Recorder={})}(this,function(e){"use strict";void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(r){var i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return i?new Promise(function(e,t){i.call(navigator,r,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))});var a={sampleRate:16e3,sampleBits:16,bufferSize:16384,numberOfInputChannels:1,numberOfOutputChannels:1},o={READY:"ready",RECORDING:"recording",DESTROYED:"destroyed"};Object.freeze(o);var t=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=a);var r=t.sampleRate;void 0===r&&(r=a.sampleRate);var i=t.sampleBits;void 0===i&&(i=a.sampleBits);var n=t.bufferSize;void 0===n&&(n=a.bufferSize),this.sampleRate=r,this.sampleBits=i,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.recorder=this.audioContext.createScriptProcessor(n,a.numberOfInputChannels,a.numberOfOutputChannels),e&&(this.xBuffer=[],this.xSize=0),this.recordable=e,this.stream=void 0,this["#state"]=o.READY},r={state:{configurable:!0}};function i(e,t){for(var r=new Float32Array(t),i=0,n=0;n<e.length;n+=1)r.set(e[n],i),i+=e[n].length;return r}function s(e,t,r){for(var i=new Float32Array(e),n=parseInt(t/r,10),a=i.length/n,o=new Float32Array(a),s=0,u=0;s<a;)o[s]=i[u],u+=n,s+=1;return o}function u(e,t,r){var i=e.length*(t/8),n=new ArrayBuffer(44+i),a=new DataView(n),o=0,s=function(e){for(var t=0;t<e.length;t+=1)a.setUint8(o+t,e.charCodeAt(t))};if(s("RIFF"),o+=4,a.setUint32(o,36+i,!0),o+=4,s("WAVE"),o+=4,s("fmt "),o+=4,a.setUint32(o,16,!0),o+=4,a.setUint16(o,1,!0),o+=2,a.setUint16(o,1,!0),o+=2,a.setUint32(o,r,!0),o+=4,a.setUint32(o,1*r*(t/8),!0),o+=4,a.setUint16(o,t/8*1,!0),o+=2,a.setUint16(o,t,!0),o+=2,s("data"),o+=4,a.setUint32(o,i,!0),o+=4,8===t)for(var u=0;u<e.length;u+=1,o+=1){var d=Math.max(-1,Math.min(1,e[u])),c=d<0?32768*d:32767*d;c=parseInt(255/(65535/(c+32768)),10),a.setInt8(o,c,!0)}else for(var f=0;f<e.length;f+=1,o+=2){var h=Math.max(-1,Math.min(1,e[f]));a.setInt16(o,h<0?32768*h:32767*h,!0)}return new Blob([a],{type:"audio/wav"})}t.prototype.start=function(n){var a=this;return new Promise(function(t,r){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){a.stream=e,a.audioContext.createMediaStreamSource(e).connect(a.recorder),a.recorder.connect(a.audioContext.destination),a.recorder.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);a.recordable&&(a.xBuffer.push(new Float32Array(t)),a.xSize+=t.length);var r=s(t,a.audioContext.sampleRate,a.sampleRate),i=u(r,a.sampleBits,a.sampleRate);n&&n({wav:i,result:r,data:t})},a["#state"]=o.RECORDING,t(e)}).catch(function(e){r(e)})})},r.state.get=function(){return this["#state"]},t.prototype.pause=function(){this.recorder.disconnect(),this.stream.getAudioTracks()[0].stop(),this["#state"]=o.READY},t.prototype.close=function(){return this.pause(),this.clearRecord(),this["#state"]=o.DESTROYED,this.audioContext.close()},t.prototype.getRecord=function(){if(this.recordable)return i(this.xBuffer,this.xSize);throw new Error("Configuration doesn't support continuous recording")},t.prototype.getRecordWav=function(){if(this.recordable){var e=u(s(i(this.xBuffer,this.xSize),this.audioContext.sampleRate,this.sampleRate),this.sampleBits,this.sampleRate);return(window.URL||window.webkitURL).createObjectURL(e)}throw new Error("Configuration doesn't support continuous recording")},t.prototype.clearRecord=function(){this.recordable&&(this.xBuffer=[],this.xSize=0)},Object.defineProperties(t.prototype,r),e.RecorderState=o,e.default=t,e.encodeWAV=u,Object.defineProperty(e,"__esModule",{value:!0})});
