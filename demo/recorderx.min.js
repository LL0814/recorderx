!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function o(e,t,n){for(var a=new Float32Array(e),i=parseInt(t/n,10),r=a.length/i,o=new Float32Array(r),s=0,d=0;s<r;)o[s]=a[d],d+=i,s+=1;return o}function s(e,t,n){var a=e.length*(t/8),i=new ArrayBuffer(44+a),r=new DataView(i),o=0,s=function(e){for(var t=0;t<e.length;t+=1)r.setUint8(o+t,e.charCodeAt(t))};if(s("RIFF"),o+=4,r.setUint32(o,36+a,!0),o+=4,s("WAVE"),o+=4,s("fmt "),o+=4,r.setUint32(o,16,!0),o+=4,r.setUint16(o,1,!0),o+=2,r.setUint16(o,1,!0),o+=2,r.setUint32(o,n,!0),o+=4,r.setUint32(o,1*n*(t/8),!0),o+=4,r.setUint16(o,t/8*1,!0),o+=2,r.setUint16(o,t,!0),o+=2,s("data"),o+=4,r.setUint32(o,a,!0),o+=4,8===t)for(var d=0;d<e.length;d+=1,o+=1){var c=Math.max(-1,Math.min(1,e[d])),u=c<0?32768*c:32767*c;u=parseInt(255/(65535/(u+32768)),10),r.setInt8(o,u,!0)}else for(var l=0;l<e.length;l+=1,o+=2){var v=Math.max(-1,Math.min(1,e[l]));r.setInt16(o,v<0?32768*v:32767*v,!0)}return new Blob([r],{type:"audio/wav"})}var d={recordable:!0,sampleRate:16e3,sampleBits:16,bufferSize:16384,numberOfInputChannels:1,numberOfOutputChannels:1},c=0,a=1,e=2,u="_state",t=function(e){void 0===e&&(e=d);var t=e.recordable;void 0===t&&(t=d.recordable);var n=e.sampleRate;void 0===n&&(n=d.sampleRate);var a=e.sampleBits;void 0===a&&(a=d.sampleBits);var i=e.bufferSize;void 0===i&&(i=d.bufferSize);var r=e.numberOfInputChannels;void 0===r&&(r=d.numberOfInputChannels);var o=e.numberOfOutputChannels;void 0===o&&(o=d.numberOfOutputChannels),this.recordable=t,this.sampleRate=n,this.sampleBits=a,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.recorder=this.audioContext.createScriptProcessor(i,r,o),t&&(this.xBuffer=[],this.xSize=0),this.stream=void 0,this[u]=c},n={state:{configurable:!0}};n.state.get=function(){return this[u]},t.prototype.start=function(i){var r=this;return new Promise(function(t,n){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){r.stream=e,r.audioContext.createMediaStreamSource(e).connect(r.recorder),r.recorder.connect(r.audioContext.destination),r.recorder.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);r.recordable&&(r.xBuffer.push(new Float32Array(t)),r.xSize+=t.length);var n=o(t,r.audioContext.sampleRate,r.sampleRate),a=s(n,r.sampleBits,r.sampleRate);i&&i({data:t,result:n,wav:a})},r[u]=a,t(e)}).catch(function(e){n(e)})})},t.prototype.pause=function(){this[u]=c,this.recorder.disconnect(),this.stream.getAudioTracks()[0].stop()},t.prototype.close=function(){return this[u]=e,this.pause(),this.clear(),this.audioContext.close()},t.prototype.getRecord=function(e){void 0===e&&(e={compressable:!1,encodeTo:void 0});var t=e.encodeTo;void 0===t&&(t=void 0);var n=e.compressable;if(void 0===n&&(n=!1),this.recordable){var a=function(e,t){for(var n=new Float32Array(t),a=0,i=0;i<e.length;i+=1)n.set(e[i],a),a+=e[i].length;return n}(this.xBuffer,this.xSize);return("wav"===t||n)&&(a=o(a,this.audioContext.sampleRate,this.sampleRate)),"function"==typeof t?a=t(a,{sampleBits:this.sampleBits,sampleRate:this.sampleRate}):"wav"===t&&(a=s(a,this.sampleBits,this.sampleRate)),a}return null},t.prototype.clear=function(){this.recordable&&(this.xBuffer=[],this.xSize=0)},Object.defineProperties(t.prototype,n),void 0!==window&&void 0!==navigator&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(n){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return a?new Promise(function(e,t){a.call(navigator,n,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this environment"))}));var i,r=document.getElementById("btn-start"),l=document.getElementById("btn-pause"),v=document.getElementById("btn-stop"),f=document.getElementById("log"),m=document.getElementById("audio"),p=document.getElementById("audio-real");function h(e,t){void 0===t&&(t="");var n='<span style="margin-right:8px">\n           '+(new Date).toLocaleString()+':\n         </span>\n         <span style="color:'+(t?"red":"blue")+'">\n           '+e+" "+t+"\n         </span>",a=document.createElement("div");a.innerHTML=n,f.appendChild(a)}r.addEventListener("click",function(){i||(i=new t({recordable:!0})),i.state===c&&i.start().then(function(e){p.srcObject=e,h("start recording")}).catch(function(e){h("Recording failed.",e)})}),l.addEventListener("click",function(){i&&i.state===a&&(i.pause(),m.src=URL.createObjectURL(i.getRecord({encodeTo:"wav"})),h("pause recording"))}),v.addEventListener("click",function(){i&&(i.close(),i=void 0,h("stop recording and destroy Recorder"))})});
